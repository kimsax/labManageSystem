{extend name="Teacher/nav"} {block name="title"}梦云智选课系统{/block} {block name="content"}
<div class="row">
    <div class="col-md-12 header">当前时间:{$currentSemester->name}第{$currentWeekorder}周</div>
</div>
<div class="container">
    <!-- 搜索功能-->
    <div class="row">
        <div class="col-md-12">
            <h3>按条件查询:</h3>
        </div>
    </div>
    <div class="row blacknav">
        <div class="col-md-12">
            <form action="{:url('index')}" method="post">
                <div class="row">
                    <div class="col-md-3">
                        <label>学期:</label>
                        <select class="btn btn-default dropdown-toggle" name="semester_id">
                            {volist name="allSemester" id="semester"}
                                <option value="{$semester->id}" {eq name="$semester->id" value="$currentSemester->id"} selected="selected"{/eq}>{$semester->name}</option>
                            {/volist}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label>周次：</label>
                        <select class="btn btn-default dropdown-toggle" name="weekorder">
                            {for start="1" end="$currentSemester->totalweek+1" }
                                <option value="{$i}" {eq name="$i" value="$currentWeekorder"} selected="selected" {/eq}>第{$i}周</option>
                            {/for}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label>选择教室：</label>
                        <select class="btn btn-default dropdown-toggle" name="classroom_id">
                            {volist name="allClassroom" id="classroom"}
                            <option value="{$classroom->id}" {eq name="$currentClassroom->id" value="$classroom->id" } selected="selected" {/eq}>{$classroom->name}</option>
                            {/volist}
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-default">搜索</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="row">
        <!-- 表格 -->
        <div class="col-md-12">
            <!-- 显示信息表格 -->
            <!-- 表格 -->
            <table class="table table-hover table-bordered">
                <tr class="info">
                    <th>星期/节次</th>
                    <th>星期一</th>
                    <th>星期二</th>
                    <th>星期三</th>
                    <th>星期四</th>
                    <th>星期五</th>
                    <th>星期六</th>
                    <th>星期日</th>
                </tr>
                {volist name="secheduleList" id="sechedules" key="key"}
                <tr>
                    <td>第{$key}节</td>
                    {volist name="sechedules" id="sechedule"}
                        <td style="text-align: center;">
                            {eq name="sechedule->teacher_id" value="$null"}
                            <span>
                                无课
                            </span>
                            {else/}
                            <span>{$sechedule->teacher->name}</span>
                            <br>
                            <span>{$sechedule->course->name}</span>
                            <br>
                            {volist name="Klasses" id="Klass"}
                              {eq name="$sechedule->getKlassesIsChecked($Klass)" value="true"}<span>{$Klass->name}</span>{else/}{/eq}
                            {/volist}
                            {/eq}
                        </td>
                    {/volist}
                </tr>
                {/volist}
            </table>
        </div>
    </div>
</div>
<!-- Button trigger modal -->
<!-- 抢课信息的表单 -->
<div class="modal fade" id="TakeLessons" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">抢课</h4>
            </div>
            <div class="modal-body">
                <form action="{:url('takeLesson')}" method="post">
                    <div class="form-group">
                        <input type="hidden" class="form-control" id="recipient-name" name="timeClassroomId">
                    </div>
                    <input type="hidden" name="teacherId" value="{$Teacher->id}">
                    <label>选择班级:</label>
                    {volist name="Klasses" id="Klass"} {eq name="$Teacher->getKlassesIsChecked($Klass)" value="true"}
                    <input type="checkbox" name="KlassIds[]" value="{$Klass->id}">
                    <label>{$Klass->name}</label>{else/}{/eq} {/volist}
                    <hr>
                    <label>选择课程:</label>
                    {volist name="Courses" id="Course"} {eq name="$Teacher->getCoursesIsChecked($Course)" value="true"}
                    <input type="radio" name="courseId" value="{$Course->id}">
                    <label>{$Course->name}</label>{else/}{/eq}
                    {/volist}
                    <div class="modal-footer">
                        <!--//添加课程的按钮-->
                        <button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#addCourse">
                            添加课程
                        </button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                        <button type="submit" class="btn btn-primary">确定抢课</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!--//添加课程的表单-->
<form action="{:url('addCourse')}">
    <div class="modal fade" id="addCourse" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <label>课程名称:</label>
                    <input name="newCourseName" placeholder="请输入要增加的课程名">
                    <input type="hidden" name="teacherID" value="{$Teacher->id}">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </div>
        </div>
    </div>
</form>

<script type="text/javascript">
$('#ChangeLessons').on('show.bs.modal', function(event) {
    var button = $(event.relatedTarget)
    var recipient = button.data('whatever')
    var modal = $(this)
    modal.find('.modal-body input').val(recipient)
})
</script>
<div class="modal fade" id="ChangeLessons" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">换课</h4>
            </div>
            <div class="modal-body">
                <form action="{:url('changeLesson')}" method="post">
                    <div class="form-group">
                        <input type="hidden" class="form-control" id="recipient-name" name="id">
                        <label>周次：</label>
                        <select class="btn btn-default dropdown-toggle" name="weekly">
                            <option value="1">第一周</option>
                            <option value="2">第二周</option>
                            <option value="3">第二周</option>
                            <option value="4">第四周</option>
                        </select>
                        &nbsp;
                        <label>星期：</label>
                        <select class="btn btn-default dropdown-toggle" name="week">
                            <option value="1">Monday</option>
                            <option value="2">Tuesday</option>
                            <option value="3">Wednesday</option>
                            <option value="4">Thursday</option>
                            <option value="5">Friday</option>
                            <option value="6">Saturday</option>
                            <option value="7">sunday</option>
                        </select>
                        &nbsp;
                        <label>节次：</label>
                        <select class="btn btn-default dropdown-toggle" name="node">
                            <option value="1">第一节</option>
                            <option value="2">第二节</option>
                            <option value="3">第三节</option>
                            <option value="4">第四节</option>
                            <option value="5">第五节</option>
                        </select>
                        &nbsp;
                        <label>教室：</label>
                        <select class="btn btn-default dropdown-toggle" name="classroom_num">
                            {volist name="allClassroom" id="classroom"}
                            <option value="{$classroom->id}" {eq name="onClassroom" value="$classroom->id" } selected="selected" {/eq}>{$classroom->name}</option>
                            {/volist}
                        </select>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">确认换课</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
$('#ChangeLessons').on('show.bs.modal', function(event) {
    var button = $(event.relatedTarget) // Button that triggered the modal
    var recipient = button.data('whatever') // Extract info from data-* attributes
    var modal = $(this)
    modal.find('#recipient-name').val(recipient)
})
</script>

{/block}